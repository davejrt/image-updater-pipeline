# Code generated by dhall-to-yaml.  DO NOT EDIT.
steps:
    - commands:
          - ".buildkite/image-updater/clean-branch-if-exists.sh"
      concurrency: 1
      concurrency_group: image-updater-pipeline/update-images
      env:
          TARGET_BRANCH: update-docker-images/images
      key: start_gate
      label: ":broom: :git: cleanup old branch"
      retry:
          manual:
              allowed: false
              permit_on_passed: false
              reason: "Sorry, queue up a new build instead (we don't want to build from outdated commits)."
    - wait: "~"
    - commands:
          - ".buildkite/image-updater/update-all-images.sh"
      concurrency: 1
      concurrency_group: image-updater-pipeline/update-images
      depends_on:
          - start_gate
      key: stage-srcimg
      label: ":bash: :k8s: commit 'srcimg' changes"
      plugins:
          - "thedyrt/git-commit#v0.3.0":
                add: "."
                branch: update-docker-images/images
                create-branch: "true"
                message: Update Docker images for image-updater-pipeline
                remote: origin
      retry:
          manual:
              allowed: false
              permit_on_passed: false
              reason: "Sorry, queue up a new build instead (we don't want to build from outdated commits)."
    - wait: "~"
    - commands:
          - ".buildkite/image-updater/create-pr.sh"
      concurrency: 1
      concurrency_group: image-updater-pipeline/update-images
      depends_on:
          - stage-srcimg
      env:
          BODY: Update Docker images for image-updater-pipeline
          HEAD: update-docker-images/images
          TITLE: Update Docker images for image-updater-pipeline
      key: stage-create-pr
      label: ":github: Open Pull Request"
      retry:
          manual:
              allowed: false
              permit_on_passed: false
              reason: "Sorry, queue up a new build instead (we don't want to build from outdated commits)."
